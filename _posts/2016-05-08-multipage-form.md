---
layout: post
title: "Multi-step Forms"
date : 2016-05-08
---

How do you create a form where you can navigate to multiple pages, and are able to submit the data only once?

Should you have a single controller connected to multiple views?

What's an approach that takes advantage of the best parts of Angular 1.x?

<a href="https://github.com/nathan-j-brenner/multipage-form" class="btn btn-info" role="button">See the code</a>

I got hired a couple months ago as a contractor for an advertising agency to write responsive html emails. Not exciting work, no javascript, and table based layout, but I get to write code all day so what's to complain?

I've gotten a lot better at writting css, to the point where I can get emails done fairly quickly in part because a lot of the templates were built by me.  When I have time to spare, I've enjoyed refactoring an internal app, and in the last few days I made a breakthrough.

For some backstory, the app was created by a senior dev, and there was a note in code that said "To future developer, I'm learning angular, so if this doesn't look that great, sorry, enjoy fixing it".  That's not verbatim, but it was kinda the point, and after working on an ionic app with ng1.4.x in TypeScript, I had gotten used to some conventions and what some may call writing the angular way, like not using jQuery in an Angular app, or keeping a clearly defined line between server side code and client side code.  This blog will focus on how I drafted a solution to that separation, which in large part was made through using services.

So imagine an angular app, perhaps one that you've written, and you've only got one controller.  You're not really sure what the situation would look like to justify multiple controllers, so you're single controller has a lot of code in it.  In my case, the app is a multipage form, and after digging around at some blogs, I found where the author got his inspiration: [https://scotch.io/tutorials/angularjs-multi-step-form-using-ui-router](https://scotch.io/tutorials/angularjs-multi-step-form-using-ui-router).

I wasn't a big fan of this approach, and recently I've been thinking about some significant conventions such as how controllers should be kept slim, controllers should be limited to a single view, and services should be used to handle data.  In this case, I wanted to take the existing app, and create an individual controller per view, and to pass along the data in each controller along each step.  More specifically, the submit button on each page would send the data of that controller to a service, along with navigating to the next state.

If you want to see the demo of where the app currently stands, clone [this repo](https://github.com/nathan-j-brenner/multipage-form), `npm install`, and `npm run dev`.  Sorry, nothing live yet, I kinda forgot how to generate it on GitHub, and this might be a good oppertunity to play with [Now](https://zeit.co/now).

At this point, I found this blog: [https://thinkster.io/a-better-way-to-learn-angularjs/services](https://thinkster.io/a-better-way-to-learn-angularjs/services), and I put it together so I could see it in practice and reference as I refactored the app in the office from my gitHub repo [sharedData](https://github.com/nathan-j-brenner/sharedData)

I hardly slept that night because I was so excited to finally slim down the massive single controller, but when I got to work, I remembered that the author was using `angular-ui-router`, more specifically embedded routes.  There was the main route: `form`, with a controller, then all the sub-routes.  I had played with the ui-router before, but taking something existing, and refactoring to this extent required some time to look at the documentation, play around with it, and build a small version of what I wanted to do.  Unfortunately, that was partly Saturday afternoon (after brewing beer), and Sunday afternoon. The result was this app: [multipage-form](https://github.com/nathan-j-brenner/multipage-form).  It's all front-end, and I used John Papa's `lite-server` (on npm), so I could debug with `ng-inspector`.  It really came out of taking the [Getting Started](https://angular-ui.github.io/ui-router/) guide for the UI-router, and combining it  with the thinkster blog. A lot of it was piece by piece refactoring from the services app and unit testing (going to the browser and seeing if the tiny change gave me what I expected, and debugging when it didn't.  When I had the behavior I wanted, I tried thinking of something fun to integrate it with, and somehow Monty Python came to mind.  That brought in an additional service for the questions, and I used the `Math` object to randomly generate the third question, along with slimming down the `Responses` Service, and the Controllers so they each basically had the same code, but were bound to separate views.

So there were two huge gains in writting this app that took about 4 hours: I gained a stronger understanding of how to implement services and how to write slim controllers, which I'll directly apply on a larger app tomorrow, and how to use use some other conventions, like not using `$scope` at all (I think one of the two apps I started with used it.  But the biggest take-away that I was lacking from Friday morning was...Each state not only required it's own controller, but the states couldn't be embedded.  Each state had to be it's own separate form that had it's own properties, and when you're ready to move onto the next state of the form, you had to do two things: Change state with `$tate.go()`, and define the properties on the service that was being used in each state of the form.  After all the questions of the form, there's a view that shows all the data that was collected (which is retrieved with a controller), and has a submit function, at which point the Service would make a post request to the API, but in this case it just shoots out an alert box with an appropriate response. Next is a Submittion state, which just verifies that you've completed the form and requests that you start the process all over again, where the data is reset and the state goes back to the first page of the form.

Where to next? The goal was to make a small app, basically a prototype, so I can debug myself on the larger app, and more sequentially move through this refactoring.  But there's other improvements I'd like to do with this app: I've been playing with the ng Form validation, so that'll probably be the next thing I add into this app before I put it in every state of the app at work.  I'd like to bring in Webpack, and I think I'll probably use a [blog](http://blog.teamtreehouse.com/26017-2)from a developer I've worked with in the past.  Adding unit tests would be good, and so would trying out the navigating from ng1 to ng2 through ngForward.  I'd love to look at the ng1 version next to the ng2, especially with the good things I've been hearing about forms.  And rewriting the same app with Typescript as also been on my mind.  I started doing that on Friday, but there was too much about Typescript that I wasn't used to, so I kept the focus in on what I would need to do to refactor that app as it currently stands.

All in all, this was a project I created so I could create more form-apps in the future without reinventing the wheel.  Using paper forms, like at the dmv or doctor's offices, or at restraunts drives me nuts.  I'd love to walk down the street frommy house to the small-business sushi restraunt and offer them something like this so I can order sushi easier, and maybe they can see a roi.
